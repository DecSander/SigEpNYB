<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>SigEp | Remove Member</title>
</head>
<body>
	<noscript>You need javascript!</noscript>
	<h1 id="name"></h1><br>
	<script>
		function getCookie(cname) {
		    var name = cname + "=";
		    var ca = document.cookie.split(';');
		    for(var i=0; i<ca.length; i++) {
		        var c = ca[i];
		        while (c.charAt(0)==' ') c = c.substring(1);
		        if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
		    }
		    return "";
		}
		
		var token = getCookie('token');
		
		var xhr = new XMLHttpRequest();
		xhr.onreadystatechange = function() {
			if (xhr.readyState == 4) {
	    		var resp = JSON.parse(xhr.responseText);
	    		if (resp == null) {
	    			logout();
	    		} else {
	    			document.getElementById('name').innerHTML = resp.firstName + ' ' + resp.lastName;
	    		}
			}
		}
		
		xhr.open('GET', 'Account', true);
		xhr.setRequestHeader('Auth', token);
		xhr.send(null);
		
		function logout() {
			var xhr = new XMLHttpRequest();
			xhr.onreadystatechange = function() {
	    		if (xhr.readyState == 4) {
	        		window.location.href = '/Fratsite/index.html';
	        		document.cookie = "token=; expires=Thu, 01 Jan 1970 00:00:00 UTC";
	    		}
			}
			
			xhr.open('DELETE', 'Login', true);
			xhr.setRequestHeader('Auth', token);
			xhr.send(null);
		}
		
		function removeMember() {
			var netid = document.getElementById('netid');
			var data = {netid:netid.value};
			
			var xhr = new XMLHttpRequest();
			xhr.onreadystatechange = function() {
	    		if (xhr.readyState == 4) {
	        		var msg;
	    			if (xhr.status == 200) {
	        			msg = "Deleted " + netid.value + " sucessfully";
	        		} else {
	        			msg = "Error - delete was unsecessful";
	        		}
	    			document.getElementById('status').innerHTML = msg;
	    			netid.value = "";
	    		}
			}
			
			xhr.open('DELETE', 'Accounts', true);
			xhr.setRequestHeader('Auth', token);
			xhr.send(JSON.stringify(data));
		}
	</script>
	<h2>Remove Member</h2>
	<form onsubmit="removeMember(); return false;">
		NetID: <input type="text" id="netid"/>
		<input type="submit" value="Remove"/>
	</form>
	<div id="status"></div><br>
	<br>
	<button onclick="window.location.href='/Fratsite/dashboard.html'">Dashboard</button>
</body>
</html>