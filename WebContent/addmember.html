<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>SigEp | Add Member</title>
</head>
<body>
	<noscript>You need javascript!</noscript>
	<h1 id="name"></h1><br>
	<script>
		function getCookie(cname) {
		    var name = cname + "=";
		    var ca = document.cookie.split(';');
		    for(var i=0; i<ca.length; i++) {
		        var c = ca[i];
		        while (c.charAt(0)==' ') c = c.substring(1);
		        if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
		    }
		    return "";
		}
		
		var token = getCookie('token');
		
		var xhr = new XMLHttpRequest();
		xhr.onreadystatechange = function() {
			if (xhr.readyState == 4) {
	    		var resp = JSON.parse(xhr.responseText);
	    		if (resp == null) {
	    			logout();
	    		} else {
	    			document.getElementById('name').innerHTML = resp.firstName + ' ' + resp.lastName;
	    		}
			}
		}
		
		xhr.open('GET', 'Account', true);
		xhr.setRequestHeader('Auth', token);
		xhr.send(null);
		
		function logout() {
			var xhr = new XMLHttpRequest();
			xhr.onreadystatechange = function() {
	    		if (xhr.readyState == 4) {
	        		window.location.href = '/Fratsite/index.html';
	        		document.cookie = "token=; expires=Thu, 01 Jan 1970 00:00:00 UTC";
	    		}
			}
			
			xhr.open('DELETE', 'Login', true);
			xhr.setRequestHeader('Auth', token);
			xhr.send(null);
		}
		
		function addAccount() {
			var netid = document.getElementById('netid').value;
			document.getElementById('netid').value = '';
			var firstName = document.getElementById('firstName').value;
			document.getElementById('firstName').value = '';
			var lastName = document.getElementById('lastName').value;
			document.getElementById('lastName').value = '';
			var msg = {netid:netid, firstName:firstName, lastName:lastName};
			
			var xhr = new XMLHttpRequest();
			xhr.onreadystatechange = function() {
	    		if (xhr.readyState == 4) {
	        		var status;
	    			if (xhr.status == 200) {
	        			status = "Successfully created an account for " + firstName;
	        		} else {
	        			status = "Account creation failed";
	        		}
	        		document.getElementById("status").innerHTML = status;
	    		}
			}
			
			xhr.open('POST', 'Accounts', true);
			xhr.setRequestHeader('Auth', token);
			xhr.send(JSON.stringify(msg));
		}
	</script>
	
	<h2>New Member Info</h2>
	<form onsubmit="addAccount(); return false;">
		NetID: <input type="text" id="netid"/><br>
		First Name: <input type="text" id="firstName"/><br>
		Last Name: <input type="text" id="lastName"/><br>
		<input type="submit" value="Submit"/>
	</form>
	<div id="status"></div><br>
	
	<button onclick="window.location.href='/Fratsite/dashboard.html'">Dashboard</button>
</body>
</html>