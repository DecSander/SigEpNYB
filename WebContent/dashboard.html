<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>SigEp | Dashboard</title>
</head>
<body>
	<noscript>You need javascript!</noscript>
	
	<h1 id="name"></h1>
	<div id="roles"></div>
	
	<script type="text/javascript">
		function getCookie(cname) {
		    var name = cname + "=";
		    var ca = document.cookie.split(';');
		    for(var i=0; i<ca.length; i++) {
		        var c = ca[i];
		        while (c.charAt(0)==' ') c = c.substring(1);
		        if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
		    }
		    return "";
		}
		
		var token = getCookie('token');
		
		var xhr = new XMLHttpRequest();
		xhr.onreadystatechange = function() {
    		if (xhr.readyState == 4) {
        		var resp = JSON.parse(xhr.responseText);
        		if (resp == null) {
        			logout();
        		} else {
        			document.getElementById('name').innerHTML = resp.firstName + ' ' + resp.lastName;
        		}
    		}
		}
		
		xhr.open('GET', 'Account', true);
		xhr.setRequestHeader('Auth', token);
		xhr.send(null);
		
		function logout() {
			var xhr = new XMLHttpRequest();
			xhr.onreadystatechange = function() {
	    		if (xhr.readyState == 4) {
	        		window.location.href = '/Fratsite/index.html';
	        		document.cookie = "token=; expires=Thu, 01 Jan 1970 00:00:00 UTC";
	    		}
			}
			
			xhr.open('DELETE', 'Login', true);
			xhr.setRequestHeader('Auth', token);
			xhr.send(null);
		}
		
		var xhr2 = new XMLHttpRequest();
		xhr2.onreadystatechange = function() {
    		if (xhr2.readyState == 4) {
        		var resp = JSON.parse(xhr2.responseText);
        		var rolesHTML = '';
        		for (var i = 0; i < resp.length; i++) {
        			var role = resp[i];
        			rolesHTML += '<h3>' + role.name + '</h3>'
        			for (var j = 0; j < role.links.length; j++) {
        				var link = role.links[j];
        				rolesHTML += '<a href=' + link.href + '>' + link.pageName + '</a><br>'
        			}
        		}
        		document.getElementById('roles').innerHTML = rolesHTML;
    		}
		}
		
		xhr2.open('GET', 'Roles', true);
		xhr2.setRequestHeader('Auth', token);
		xhr2.send(null);
	</script>
	
	<br><br>
	<input type="submit" value="Logout" onclick="logout()"/>
</body>
</html>